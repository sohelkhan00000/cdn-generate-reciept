let xstartDate,xendDate,isControlsValid=!0,islazyLoadingDone=!1;const toggleSpinner=document.querySelector("#downloadPDF .spinner-grow"),toggleDownload=document.querySelector("#downloadPDF .download-text"),button=document.getElementById("downloadPDF");var mainContainer=document.getElementById("allSlips");let linkbtn=document.getElementById("linkmblmenu"),moblNav=document.getElementById("nav-links"),inputRenterName=document.getElementById("inputRenterName");function lazyLoading(){if(!islazyLoadingDone){islazyLoadingDone=!0;let e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js",e.async=!0,e.onload=()=>{islazyLoadingDone=!0,console.log("Script loaded successfuly")},e.onerror=()=>{islazyLoadingDone=!1,console.log("Error occurred while loading script")},document.body.appendChild(e)}}function getMonthShortName(e){let t=new Date;return t.setMonth(e-1),t.toLocaleString("en-US",{month:"short"})}function addMonths(e,t,n){Date.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.prototype.isLeapYear=function(){return Date.isLeapYear(this.getFullYear())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this};var a,l=new Date(e),i=new Date(t),r=[],o=new Date(l),d=!1,s=o.addMonths(n);if(a=new Date(s),s.setDate(s.getDate()-1),i<=a?(r[0]={start:l,end:i},d=!1):(r[0]={start:l,end:s},d=!0),d)for(let c=1;r[r.length-1].end<i;c++){let g=new Date(a);var s=(o=new Date(a)).addMonths(n);a=new Date(s),s.setDate(s.getDate()-1),i<=a?r[c]={start:g,end:i}:r[c]={start:g,end:s}}return r.forEach((e,t,n)=>{n[t]={start:e.start.toLocaleDateString("af-ZA",{year:"numeric",month:"2-digit",day:"2-digit"}),end:e.end.toLocaleDateString("af-ZA",{year:"numeric",month:"2-digit",day:"2-digit"})}}),r}function checkValidation(e,t,n,a){if("Name"==t)return""==e?(a(!1,n+" cannot be  empty!"),!1):e.length>35?(a(!1,n+" cannot be more than 35 characters!"),!1):/\d/g.test(e)?(a(!1,n+" cannot contain numbers and space!"),!1):(a(!0,n+" validated successfully!"),!0);if("Empty"==t)return""==e?(a(!1,n+" cannot be empty!"),!1):(a(!0,n+" validated successfully!"),!0)}function addDynamicData(){let e=document.getElementById("inputRent"),t=document.getElementById("textboxAddress"),n=document.getElementById("inputOwnerName"),a=document.getElementById("inputOwnerPan");document.getElementById("flexRadioMonthly");let l=document.getElementById("dataPickerFrom"),i=document.getElementById("dataPickerTo"),r=document.getElementById("pdfNameError"),o=document.getElementById("pdfRentError"),d=document.getElementById("pdfAddressError"),s=document.getElementById("pdfOwnerError");document.getElementById("pdfOwnerPanError");let c=document.getElementById("pdfDateFromError"),g=document.getElementById("pdfDateToError");checkValidation(inputRenterName.value,"Name","Name",function(e,t){e?r.style.display="none":(r.innerHTML=t,r.style.display="block")}),checkValidation(e.value,"Empty","Rent",function(e,t){e?o.style.display="none":(o.innerHTML=t,o.style.display="block")}),checkValidation(t.value,"Empty","Address",function(e,t){e?d.style.display="none":(d.innerHTML=t,d.style.display="block")}),checkValidation(n.value,"Name","Owner's name",function(e,t){e?s.style.display="none":(s.innerHTML=t,s.style.display="block")}),checkValidation(l.value,"Empty","Date",function(e,t){e?c.style.display="none":(c.innerHTML=t,c.style.display="block")}),checkValidation(i.value,"Empty","Date",function(e,t){e?g.style.display="none":(g.innerHTML=t,g.style.display="block")});let y=document.getElementsByClassName("validation-message");isControlsValid=!0,Object.keys(y).some(function(e){if("block"==y[e].style.display){t="pdfAddressError"==y[e].id?130:80;var t,n=y[e].getBoundingClientRect().top+window.pageYOffset-t;return window.scrollTo({top:n,behavior:"smooth"}),y[e].previousElementSibling.focus(),isControlsValid=!1,!0}});let m=document.getElementById("pdfRenterName"),p=document.getElementById("pdfRent"),u=document.getElementById("pdfAddress"),f=document.getElementById("pdfLandlordName"),h=document.getElementById("pdfLandlordPan"),E=document.getElementById("pdfDateFrom"),D=document.getElementById("pdfDateTo"),M=document.getElementById("pdfCurrentMonth"),L=document.getElementById("pdfReceiptNumber"),$=document.getElementById("pdfGenerateDate");if(m.innerHTML=inputRenterName.value,p.innerHTML=e.value,u.innerHTML=t.value,f.innerHTML=n.value,h.innerHTML=a.value,xstartDate=l.value,xendDate=i.value,isControlsValid){let _=document.getElementById("flexRadioMonthly"),v=1;_.checked||(v=3);let B=addMonths(xstartDate,xendDate,v),I=new Date().toString();I=I.slice(4,15),B.forEach((e,t,n)=>{if(1==n.length)E.innerHTML=e.start,D.innerHTML=e.end,M.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),L.innerHTML="1",$.innerHTML=I;else if(0==t)E.innerHTML=e.start,D.innerHTML=e.end,M.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),L.innerHTML="1",$.innerHTML=I;else{var a=document.getElementById("invoice1").cloneNode(!0);if(a.id="invoice"+(t+1),mainContainer.appendChild(a),document.querySelector("#invoice"+(t+1)+"  #pdfDateFrom").innerHTML=e.start,document.querySelector("#invoice"+(t+1)+"  #pdfDateTo").innerHTML=e.end,document.querySelector("#invoice"+(t+1)+"  #pdfCurrentMonth").innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),document.querySelector("#invoice"+(t+1)+"  #pdfReceiptNumber").innerHTML=t+1,document.querySelector("#invoice"+(t+1)+"  #pdfGenerateDate").innerHTML=I,(t+1)%3==0&&0!=t){generateAdd();let l=document.createElement("div");l.setAttribute("class","html2pdf__page-break"),mainContainer.appendChild(l)}}(t+1)%3!=0&&t+1==n.length&&generateAdd()})}}function resetPage(e){toggleSpinner.style.display="none",toggleDownload.innerHTML="Download";let t=document.getElementsByClassName("invoice");for(;t.length>1;)t[1].parentNode.removeChild(t[1]);let n=document.getElementsByClassName("html2pdf__page-break");for(;n.length>0;)n[0].parentNode.removeChild(n[0]);let a=document.getElementsByClassName("page-add");for(;a.length>0;)a[0].parentNode.removeChild(a[0])}function generateAdd(){let e=document.createElement("div");e.setAttribute("class","page-add"),e.innerHTML="Generated by https://www.generatereceipt.blogspot.com",mainContainer.appendChild(e)}function generatePDF(){if(addDynamicData(),isControlsValid){toggleSpinner.style.display="inline-block",toggleDownload.innerHTML="PDF Generating...";let e=document.getElementById("allSlips");html2pdf().set({jsPDF:{format:"a4",orientation:"portrait"},html2canvas:{letterRendering:!0,useCORS:!0,logging:!0,scrollX:0,scrollY:0},margin:0,image:{type:"jpeg",quality:.98}}).from(e).toPdf().save("Rent receipt by Generate Receipt").then(e=>{resetPage(),gtag("event","PDF download",{eventCategory:"category_value",dimension5:"custom data"})}).catch(e=>{console.log("PDF Error "+e)})}}button.addEventListener("click",()=>{generatePDF()}),linkbtn.addEventListener("click",()=>{moblNav.classList.toggle("d-block")}),inputRenterName.addEventListener("keyup",()=>{lazyLoading()});