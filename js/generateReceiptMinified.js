/* custom js file */

let xstartDate,xendDate,isControlsValid=!0;const toggleSpinner=document.querySelector("#downloadPDF .spinner-grow"),toggleDownload=document.querySelector("#downloadPDF .download-text"),button=document.getElementById("downloadPDF"),knuncleNumbers=[31,28,31,30,31,30,31,31,30,31,30,31];function countMonths(e,t){var n;return e=new Date(e),n=((t=new Date(t)).getFullYear()-e.getFullYear())*12,n-=e.getMonth(),(n+=t.getMonth())<=0?0:n}function getMonthShortName(e){let t=new Date;return t.setMonth(e-1),t.toLocaleString("en-US",{month:"short"})}function getLastDate(e){let t=new Date(e);return e=e.substring(0,8),e+=knuncleNumbers[t.getMonth()]}function dateRange(e,t){for(var n=e.split("-"),a=t.split("-"),r=parseInt(n[0]),l=parseInt(a[0]),o=[],i=r;i<=l;i++)for(var s=i!=l?11:parseInt(a[1])-1,d=i===r?parseInt(n[1])-1:0,g=d;g<=s;g=g>12?g%12||11:g+1){var c=g+1,u=c<10?"0"+c:c;o.push([i,u,"01"].join("-"))}return o}function countDays(e,t){var n,a=new Date(e);return(new Date(t).getTime()-a.getTime())/864e5}function formatDate(e){let t=e.getDate();console.log(t);let n=e.getMonth();console.log(n+1);let a;return e.getFullYear()+"-"+n+"-"+t}function addMonths(e,t){Date.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.prototype.isLeapYear=function(){return Date.isLeapYear(this.getFullYear())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this};var n,a=new Date("2013-01-16"),r=new Date("2014-01-17"),l=[],o=new Date(a),i=!1,s=o.addMonths(3);if(n=new Date(s),s.setDate(s.getDate()-1),r<=n?(l[0]={start:a,end:r},i=!1,console.log("===first iteration date is less than end date")):(l[0]={start:a,end:s},i=!0,console.log("===first iteration date is greater than end date"+JSON.stringify(l))),i)for(let d=1;l[l.length-1].end<r;d++){console.log("===enters in loop");let g=new Date(n);var s=(o=new Date(n)).addMonths(3);n=new Date(s),s.setDate(s.getDate()-1),r<=n?(l[d]={start:g,end:r},console.log("Qwerter date exeeds "+n)):(console.log("Date greater then end date"),l[d]={start:g,end:s})}console.log(l)}function allDate(e){var t=new Date(xstartDate),n=new Date(xendDate);knuncleNumbers[t.getMonth()],knuncleNumbers[n.getMonth()],t.getDate(),n.getDate();var a=[];let r=0,l=countMonths(xstartDate,xendDate),o=[];for(let i=0;i<l;i++)o[i]=xstartDate;return e.forEach(function(e,t,n){if(n.length<=3){if(n.forEach((e,t)=>{r+=knuncleNumbers[parseInt(n[t].slice(5,7))]}),r<=92)return a=[{start:xstartDate,end:xendDate}],!0}else{var l=addMonths(n[t],3);l=formatDate(l),a[t]={start:xstartDate,end:l}}}),a}function checkValidation(e,t,n,a){if("Name"==t)return""==e?(a(!1,n+" cannot be  empty!"),!1):e.length>35?(a(!1,n+" cannot be more than 35 characters!"),!1):/\d/g.test(e)?(a(!1,n+" cannot contain numbers and space!"),!1):(a(!0,n+" validated successfully!"),!0);if("Empty"==t)return""==e?(a(!1,n+" cannot be empty!"),!1):(a(!0,n+" validated successfully!"),!0)}function addDynamicData(){let e=document.getElementById("inputRenterName"),t=document.getElementById("inputRent"),n=document.getElementById("textboxAddress"),a=document.getElementById("inputOwnerName"),r=document.getElementById("inputOwnerPan");document.getElementById("flexRadioMonthly");let l=document.getElementById("dataPickerFrom"),o=document.getElementById("dataPickerTo"),i=document.getElementById("pdfNameError"),s=document.getElementById("pdfRentError"),d=document.getElementById("pdfAddressError"),g=document.getElementById("pdfOwnerError");document.getElementById("pdfOwnerPanError");let c=document.getElementById("pdfDateFromError"),u=document.getElementById("pdfDateToError");checkValidation(e.value,"Name","Name",function(e,t){e?i.style.display="none":(i.innerHTML=t,i.style.display="block")}),checkValidation(t.value,"Empty","Rent",function(e,t){e?s.style.display="none":(s.innerHTML=t,s.style.display="block")}),checkValidation(n.value,"Empty","Address",function(e,t){e?d.style.display="none":(d.innerHTML=t,d.style.display="block")}),checkValidation(a.value,"Name","Owner's name",function(e,t){e?g.style.display="none":(g.innerHTML=t,g.style.display="block")}),checkValidation(l.value,"Empty","Date",function(e,t){e?c.style.display="none":(c.innerHTML=t,c.style.display="block")}),checkValidation(o.value,"Empty","Date",function(e,t){e?u.style.display="none":(u.innerHTML=t,u.style.display="block")});let y=document.getElementsByClassName("validation-message");isControlsValid=!0,Object.keys(y).some(function(e){if("block"==y[e].style.display)return isControlsValid=!1,!0});let m=document.getElementById("pdfRenterName"),p=document.getElementById("pdfRent"),f=document.getElementById("pdfAddress"),h=document.getElementById("pdfLandlordName"),_=document.getElementById("pdfLandlordPan"),D=document.getElementById("pdfDateFrom"),$=document.getElementById("pdfDateTo"),M=document.getElementById("pdfCurrentMonth"),E=document.getElementById("pdfReceiptNumber"),v=document.getElementById("pdfGenerateDate");m.innerHTML=e.value,p.innerHTML=t.value,f.innerHTML=n.value,h.innerHTML=a.value,_.innerHTML=r.value;let L=allDate(dateRange(xstartDate=l.value,xendDate=o.value)),T=new Date().toString();T=T.slice(4,15),L.forEach((e,t,n)=>{if(1==n.length)D.innerHTML=e.start,$.innerHTML=e.end,M.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),E.innerHTML="1",v.innerHTML=T;else if(0==t)D.innerHTML=e.start,$.innerHTML=e.end,M.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),E.innerHTML="1",v.innerHTML=T;else{var a=document.getElementById("allSlips"),r=document.getElementById("invoice1").cloneNode(!0);if(r.id="invoice"+(t+1),a.appendChild(r),document.querySelector("#invoice"+(t+1)+"  #pdfDateFrom").innerHTML=e.start,document.querySelector("#invoice"+(t+1)+"  #pdfDateTo").innerHTML=e.end,document.querySelector("#invoice"+(t+1)+"  #pdfCurrentMonth").innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),document.querySelector("#invoice"+(t+1)+"  #pdfReceiptNumber").innerHTML=t+1,document.querySelector("#invoice"+(t+1)+"  #pdfGenerateDate").innerHTML=T,(t+1)%3==0&&0!=t){let l=document.createElement("div");l.setAttribute("class","html2pdf__page-break"),a.appendChild(l)}}}),console.log(L)}function resetPage(e){toggleSpinner.style.display="none",toggleDownload.innerHTML="Download";let t=document.getElementsByClassName("invoice");for(;t.length>1;)t[1].parentNode.removeChild(t[1]);let n=document.getElementsByClassName("html2pdf__page-break");for(;n.length>1;)n[1].parentNode.removeChild(n[1])}function generatePDF(){if(addDynamicData(),isControlsValid){toggleSpinner.style.display="inline-block",toggleDownload.innerHTML="PDF Generating...";let e=document.getElementById("allSlips");html2pdf().set({jsPDF:{format:"a4",orientation:"portrait"},html2canvas:{letterRendering:!0,useCORS:!0,logging:!0,scrollX:0,scrollY:0},margin:0,image:{type:"jpeg",quality:2}}).from(e).toPdf().save("Rent slip by Generate Receipt").then(e=>{resetPage()}).catch(e=>{console.log("PDF Error "+e)})}}button.addEventListener("click",generatePDF);