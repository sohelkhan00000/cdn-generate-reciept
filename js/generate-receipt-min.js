let xstartDate,xendDate,isControlsValid=!0;const toggleSpinner=document.querySelector("#downloadPDF .spinner-grow"),toggleDownload=document.querySelector("#downloadPDF .download-text"),button=document.getElementById("downloadPDF"),knuncleNumbers=[31,28,31,30,31,30,31,31,30,31,30,31];function countMonths(e,t){var n;return e=new Date(e),n=((t=new Date(t)).getFullYear()-e.getFullYear())*12,n-=e.getMonth(),(n+=t.getMonth())<=0?0:n}function getMonthShortName(e){let t=new Date;return t.setMonth(e-1),t.toLocaleString("en-US",{month:"short"})}function getLastDate(e){let t=new Date(e);return e=e.substring(0,8),e+=knuncleNumbers[t.getMonth()]}function countDays(e,t){var n,a=new Date(e);return(new Date(t).getTime()-a.getTime())/864e5}function addMonths(e,t,n){Date.isLeapYear=function(e){return e%4==0&&e%100!=0||e%400==0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.prototype.isLeapYear=function(){return Date.isLeapYear(this.getFullYear())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this};var a,r=new Date(e),l=new Date(t),i=[],o=new Date(r),d=!1,s=o.addMonths(n);if(a=new Date(s),s.setDate(s.getDate()-1),l<=a?(i[0]={start:r,end:l},d=!1):(i[0]={start:r,end:s},d=!0),d)for(let c=1;i[i.length-1].end<l;c++){let g=new Date(a);var s=(o=new Date(a)).addMonths(n);a=new Date(s),s.setDate(s.getDate()-1),l<=a?i[c]={start:g,end:l}:i[c]={start:g,end:s}}return i.forEach((e,t,n)=>{n[t]={start:e.start.toLocaleDateString("af-ZA",{year:"numeric",month:"2-digit",day:"2-digit"}),end:e.end.toLocaleDateString("af-ZA",{year:"numeric",month:"2-digit",day:"2-digit"})}}),i}function checkValidation(e,t,n,a){if("Name"==t)return""==e?(a(!1,n+" cannot be  empty!"),!1):e.length>35?(a(!1,n+" cannot be more than 35 characters!"),!1):/\d/g.test(e)?(a(!1,n+" cannot contain numbers and space!"),!1):(a(!0,n+" validated successfully!"),!0);if("Empty"==t)return""==e?(a(!1,n+" cannot be empty!"),!1):(a(!0,n+" validated successfully!"),!0)}function addDynamicData(){let e=document.getElementById("inputRenterName"),t=document.getElementById("inputRent"),n=document.getElementById("textboxAddress"),a=document.getElementById("inputOwnerName"),r=document.getElementById("inputOwnerPan");document.getElementById("flexRadioMonthly");let l=document.getElementById("dataPickerFrom"),i=document.getElementById("dataPickerTo"),o=document.getElementById("pdfNameError"),d=document.getElementById("pdfRentError"),s=document.getElementById("pdfAddressError"),c=document.getElementById("pdfOwnerError");document.getElementById("pdfOwnerPanError");let g=document.getElementById("pdfDateFromError"),y=document.getElementById("pdfDateToError");checkValidation(e.value,"Name","Name",function(e,t){e?o.style.display="none":(o.innerHTML=t,o.style.display="block")}),checkValidation(t.value,"Empty","Rent",function(e,t){e?d.style.display="none":(d.innerHTML=t,d.style.display="block")}),checkValidation(n.value,"Empty","Address",function(e,t){e?s.style.display="none":(s.innerHTML=t,s.style.display="block")}),checkValidation(a.value,"Name","Owner's name",function(e,t){e?c.style.display="none":(c.innerHTML=t,c.style.display="block")}),checkValidation(l.value,"Empty","Date",function(e,t){e?g.style.display="none":(g.innerHTML=t,g.style.display="block")}),checkValidation(i.value,"Empty","Date",function(e,t){e?y.style.display="none":(y.innerHTML=t,y.style.display="block")});let m=document.getElementsByClassName("validation-message");isControlsValid=!0,Object.keys(m).some(function(e){if("block"==m[e].style.display)return isControlsValid=!1,!0});let p=document.getElementById("pdfRenterName"),u=document.getElementById("pdfRent"),h=document.getElementById("pdfAddress"),f=document.getElementById("pdfLandlordName"),M=document.getElementById("pdfLandlordPan"),_=document.getElementById("pdfDateFrom"),E=document.getElementById("pdfDateTo"),D=document.getElementById("pdfCurrentMonth"),$=document.getElementById("pdfReceiptNumber"),L=document.getElementById("pdfGenerateDate");if(p.innerHTML=e.value,u.innerHTML=t.value,h.innerHTML=n.value,f.innerHTML=a.value,M.innerHTML=r.value,xstartDate=l.value,xendDate=i.value,isControlsValid){let v=document.getElementById("flexRadioMonthly"),T=1;v.checked||(T=3);let I=addMonths(xstartDate,xendDate,T),B=new Date().toString();B=B.slice(4,15),I.forEach((e,t,n)=>{if(1==n.length)_.innerHTML=e.start,E.innerHTML=e.end,D.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),$.innerHTML="1",L.innerHTML=B;else if(0==t)_.innerHTML=e.start,E.innerHTML=e.end,D.innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),$.innerHTML="1",L.innerHTML=B;else{var a=document.getElementById("allSlips"),r=document.getElementById("invoice1").cloneNode(!0);if(r.id="invoice"+(t+1),a.appendChild(r),document.querySelector("#invoice"+(t+1)+"  #pdfDateFrom").innerHTML=e.start,document.querySelector("#invoice"+(t+1)+"  #pdfDateTo").innerHTML=e.end,document.querySelector("#invoice"+(t+1)+"  #pdfCurrentMonth").innerHTML=getMonthShortName(e.start.slice(5,7))+" "+e.start.slice(0,4),document.querySelector("#invoice"+(t+1)+"  #pdfReceiptNumber").innerHTML=t+1,document.querySelector("#invoice"+(t+1)+"  #pdfGenerateDate").innerHTML=B,(t+1)%3==0&&0!=t){let l=document.createElement("div");l.setAttribute("class","page-add"),l.innerHTML="Generated by https://www.generatereceipt.blogspot.com",a.appendChild(l);let i=document.createElement("div");i.setAttribute("class","html2pdf__page-break"),a.appendChild(i)}}}),console.log(I)}}function resetPage(e){toggleSpinner.style.display="none",toggleDownload.innerHTML="Download";let t=document.getElementsByClassName("invoice");for(;t.length>1;)t[1].parentNode.removeChild(t[1]);let n=document.getElementsByClassName("html2pdf__page-break");for(;n.length>1;)n[1].parentNode.removeChild(n[1])}function generatePDF(){if(addDynamicData(),isControlsValid){toggleSpinner.style.display="inline-block",toggleDownload.innerHTML="PDF Generating...";let e=document.getElementById("allSlips");html2pdf().set({jsPDF:{format:"a4",orientation:"portrait"},html2canvas:{letterRendering:!0,useCORS:!0,logging:!0,scrollX:0,scrollY:0},margin:0,image:{type:"jpeg",quality:1}}).from(e).toPdf().save("Rent receipt by Generate Receipt").then(e=>{resetPage()}).catch(e=>{console.log("PDF Error "+e)})}}button.addEventListener("click",generatePDF);